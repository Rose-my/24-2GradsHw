<!-- Template for PROJECT REPORT of CapstoneDesign 2024-2H, initially written by khyoo -->
<!-- 본 파일은 2024년도 컴공 졸업프로젝트의 <1차보고서> 작성을 위한 기본 양식입니다. -->
<!-- 아래에 "*"..."*" 표시는 italic체로 출력하기 위해서 사용한 것입니다. -->
<!-- "내용"에 해당하는 부분을 지우고, 여러분 과제의 내용을 작성해 주세요. -->

# Team-Info
| (1) 과제명                | C.LOVA(클로바) : Multimodal LLM을 통해 이화여대 내 분실물을 쉽고 효율적으로 등록, 관리, 찾을 수 있는 웹서비스 |
|:---  |---  |
| (2) 팀 번호 / 팀 이름 | 09-보성말차 |
| (3) 팀 구성원 | 이서영(2029028) : 리더, AI/Data <br> 김민영(2073028) : 팀원, 프론트엔드 <br> 이정은(2128020) : 팀원, 백엔드			 |
| (4) 팀 지도교수           | 오세은                                                                                                        |
| (5) 팀 멘토               | 정아연 / 개발자 / 라인플러스                                                                                  |
| (6) 과제 분류 | 산학 과제 |
| (7) 과제 키워드(keywords) | 분실물, 멀티모달 LLM 모델, DB, WEB     
| (8) 과제 내용 요약        | [한줄소개] <br> C.LOVA(클로바 : 클릭 한 번으로 바로 찾는 분실물)는 **분실물**을 쉽고 효율적으로 **등록, 관리 그리고 찾을 수 있는** 웹서비스입니다. <br><br> [페인포인트] <br> 저희는 현재 **이화여대 학생서비스센터**에서 제공하는 분실물 게시판은 내용이 **검색 기능**이 제대로 작동하지 않고 **DB가 분산**되어있다는 불편함을 발견하고 이러한 프로젝트를 고안하게 되었습니다. <br><br> [주요 목적] <li>간단한 정보 입력을 통한 신속한 분실물 **검색** </li> <li>데이터 기반의 **정확한 매칭**</li> <li>사용자 친화적인 **자동 완성** 습득물 **등록**과정 </li> <br> [타겟 유저]<br> 저희 서비스의 타겟 유저는 2부류가 있습니다. <li>**분실물을 획득**한 사람이 이미지를 등록하면 챗지피티 API가 물건이 가지고 있는 시각적 특징을 텍스트로 생성하고, 그 중 중요 키워드(모양, 재질, 색, 텍스트 유무 등)를 활용하여 **분실물 데이터베이스**를 객관적이고 효율적으로 구축합니다. </li><li> **물건을 찾으려는** 사람이 자신의 잃어버린 물건에 대한 설명을 **프롬프트로 제시**하면 해당 설명과 DB 내 키워드들의 유사도 검사를 통해 유력한 분실물을 필터링하여 상위 3개의 유력한 분실물 정보를 제공합니다. </li><br> [기대효과] <li>교내 분실물의 **반환율을 높이며** 분실물 저장 공간, 재정적 낭비 감소 </li> <li>분실물 **등록 과정 간소화**를 통해 습득 물품 관리자의 부담을 덜어줌 </li> <li>서비스 및 타겟 확대를 통해 광고 수익 창출 및 타학교 **분실물 센터들과의 협업**을 통한 BM 구성 </li>   |

<br>

# Project-Summary
| 항목 | 내용 |
|:---  |---  |
| (1) 문제 정의 | 교내에서 하루에 다섯 건 이상의 분실물이 발생하지만, **이화여대 학생서비스센터 분실물 게시판**은 물건에 대한 카테고리나 상세 정보를 제공하지 않아 <li> **분실물을 찾으려면** 모든 게시물을 하나하나 확인해야 하는 불편함 존재 </li><li> **분실물을 등록할 때마다** 모든 항목을 일일이 채워야 하므로 등록 과정 자체가 번거로워 누락된 정보가 많은 상황 </li><br> 따라서, 저희는 이러한 pain point를 인지했고, 학생들이 **자신이 찾는 물건에 대해 빠르고 정확하게 접근**할 수 있으며, **등록 과정 또한 간소화**하여 효율적으로 운영하는 `C.LOVA(클로바)`를 제안합니다.|
| (2) 기존연구와의 비교 | **1. 복잡한 검색 기능 해소** <br><img width="700" alt="검색 비교" src="https://github.com/user-attachments/assets/03b7dbb6-62a7-4e65-b468-2c2915be2b81"><br><br>**2. 불편한 등록 과정 간소화**<br> <img width="700" alt="등록 비교" src="https://github.com/user-attachments/assets/e6a875f6-1359-482b-a50e-e77b77724454"> |
| (3) 제안 내용 | 1. **간단한 정보 입력**으로 신속한 분실물 검색 <li> 사용자가 복잡한 절차 없이 물품 정보 간편 입력 가능 </li><br> 2. **데이터 기반**의 정확한 **매칭** 기능 제공 <li> 유사도가 높은 상위 3개의 분실물과 매칭 구현 </li><br> 3. 사용자 친화적인 자동 완성 **습득물 등록과정 간소화** <li> 정보 입력 시 자동완성 기능으로 입력 편의성 강화</li> |
| (4) 기대효과 및 의의 | <li>교내 분실물 **반환율 증가**로 분실물 저장 공간 및 재정적 **낭비 감소**</li><li>분실물 **등록 과정 간소화**로 습득 물품 관리자의 부담 완화</li><li>**기능 확장** 및 **타겟 확대**로 수요 증가</li> |
| (5) 주요 기능 리스트 | **[ 분실물 검색 ]** <br> 사용자가 분실물을 설명하는 프롬프트를 입력하면 유사한 분실물을 매칭하여 보여줍니다. <br> 1. 찾고 싶은 물건을 설명할 수 있는 프롬프트 입력 <br> 2. 프롬프트 전처리 <li>**토큰화 및 불용어 제거**된 DB 내 분실물 특징 정보 GET</li><li>용어집 외래어 추가</li> 3. 프롬프트와의 유사도 계산 후 사용자의 물건일 가능성이 높은 상위 3개 물건 제시<li>**TF-IDF 유사도 모델**로 프롬프트와 DB에 저장된 분실물 **특징 정보 벡터화**</li><li>**Cosine-Similarity**로 벡터 간 각의 코사인 값을 이용, 어휘적 유사성을평가하여 상위 후보 반환</li><br> **[ 습득물 등록 ]** <br> 습득물 사진을 등록하기만 하면 이미지 설명 API로 습득물이 자동등록 됩니다. <br> 1. 습득물 이미지 업로드 <br> 2. 이미지에서 특징 정보 추출 <li>**ChatGPT 4-o 모델**이 로고, 색깔, 재질, 텍스트 등 가시적인 물품의 특징 정보를 텍스트로 추출</li> <li>**입력값 자동완성** + 개인정보 포함 이미지는 비공개 처리 + 습득장소와 보관장소 검색 기능 추가 + 생성 결과 오류를 대비하여 수정 가능 <br> 3. 습득물 게시글 업로드 및 분실물 DB 구축 |

<br>
 
# Project-Design & Implementation
| 항목 | 내용 |
|:---  |---  |
| (1) 요구사항 정의 | ![요구사항 피드백반영 drawio](https://github.com/user-attachments/assets/0feebfa7-025f-4647-9e0e-fb6965272dd3)|
| (2) 전체 시스템 구성 |**[ 시스템 아키텍쳐 구조도 ]** <br> ![아키텍처 구조도](https://github.com/user-attachments/assets/4c5ca1a4-1b41-4659-a8d9-a3a2390f6221) <br><br> **[ 분실물 검색 ]** <br> 1. 프롬프트 작성 <br> <li>사용자는 잃어버린 물건에 대해 친구에게 설명하듯이 물건 정보를 프롬프트로 작성합니다. 이후 **POST 요청**으로 서버에 텍스트를 전송합니다. <br> 예시: "은색 띠가 있는 핑크색 스탠리 텀블러" </li> <br> 2. 자연어 전처리 <br> <li>한국어 문장의 특성상 유사도 계산을 방해하는 불필요한 문장 성분을 제거하기 위해 **NLTK와 koNLPy를 활용**하여 텍스트를 토큰화하고 불용어를 제거했습니다. 또한 색상에 대한 영문 표현을 추가하였으며, 모델이 유사성을 판단하기 어려운 외국어 텍스트와 브랜드명에 대해서는 구글 번역 API를 사용해 한국어 정보를 보완하는 등 **전처리를 수행**했습니다. </li> <br> 3. 유사도 계산 <br><li> 사용자가 입력한 프롬프트와 데이터베이스에 저장된 분실물들의 특징 정보를 대상으로 **TF-IDF 모델**을 활용하여 유사도를 계산합니다. 이를 통해 상위 **3개의 유력한 분실물 게시물 ID를 매칭**하고, 프론트엔드에서 해당 게시물을 표시할 수 있도록 반환합니다.</li> <br><br> **[ 습득물 등록 ]** <br> 1. 습득물 이미지 업로드 <br><li> 이미지 업로드를 위해서 프론트엔드에서는 사용자가 선택한 이미지를 **File 타입으로 저장**한 후, **POST 요청**을 통해 서버로 전송합니다. </li> <br> 2. 물품의 특징 정보를 텍스트로 추출 <br><li> 서버는 전달받은 이미지를 ChatGpt 4-o 모델에 적용합니다. 모델은 사전에 정의한 프롬프트에 따라 이미지에서 로고, 색깔, 재질, 텍스트 등 **가시적인 물품의 특징 정보를 텍스트로 추출**합니다. </li> <br> 3. 사용자 입력 최적화 <br><li> 추출된 입력 정보를 프론트엔드에서 **GET 통신**으로 받아옵니다. 사용자는 자동으로 입력된 물건 이미지 정보를 확인할 수 있습니다. 더불어, 물건 분실 장소 또는 보관 장소는 단어의 일부만 입력해도 연관 장소를 추천하는 자동완성 기능을 통해 입력 과정을 최적화했습니다.</li>|
| (3) 주요엔진 및 기능 설계 | **[ 분실물 검색 유사도 처리 ]** <br><img width="360" alt="유사도코드1" src="https://github.com/user-attachments/assets/093099f7-1b82-4cde-9d42-6e7f09ac4825"><img width="430" alt="유사도코드2" src="https://github.com/user-attachments/assets/89d5b949-64ae-4684-826d-c1a1921eb10e"> <br><br> 1. 불필요한 문장 부호를 제거하고 동사 형용사의 경우 어간만 추출하기 위해 **koNLPy의 Komoran 패키지**를 사용하여 **토큰화**를 진행했습니다. <br><br> 2. Word2vec, ko-bert, TF-IDF 등 다양한 **한국어 유사도 모델**을 시도하며, 유사한 물건을 얼마나 가려내는지 그리고 유사도 점수의 차이는 어떠한 지 등을 확인하며 **최적의 모델을 탐색**했습니다. 그 과정 속에서 영문명이나 외래어에서의 유사도를 잘 잡아내지 못함을 인식하였습니다. 이를 보완하기 위해 <li>**이들을 한글로 표현한 특징 정보를 추가**하고,</li><li> **GPT 프롬프트에서도 답변의 경계를 설정**하였습니다.</li> 예를 들어, 너무나 많은 색깔이 세상에 존재하기 때문에 대표적인 25가지의 색 내에서만 답변하도록 설정하였고, **해당 색상들의 영어식 표현 추가**하였습니다. (EX ; 빨강이면 레드 단어 추가)</li> <br><br>3. 또한, starbucks, odense 등 **외래어 브랜드**가 물건 속 텍스트 추출 과정에서 존재했기에 **구글 번역 API**를 활용하여 스타벅스, 오덴세 등으로 추가했습니다. <br><br> 4. 이렇게 특징 정보를 구축한 후, 지도 교수님의 면담 과정에서 추천받은 **TF-IDF 기법**을 활용하여 유사도를 계산했습니다. TF-IDF는 문서 내 단어의 중요도를 가중치를 통해 계산하는 방법으로, 이를 통해 분실물 정보 간의 **유사도를 정량화**했습니다. 최종적으로 도출된 상위 3개의 유사 분실물 정보를 서버에 전송하도록 구현했습니다.  <br><br> **[ 습득물 등록 프롬프트 ]** <br><img width="362" alt="등록프롬프트" src="https://github.com/user-attachments/assets/0d8644a8-6f94-43ac-9b6a-cad284031ff8"> <br><br> 1. **프롬프트 엔지니어링**을 통해 AI가 특정 물건에 대해 정해진 범위 내에서 객관적이고 세부적으로 설명할 수 있도록 프롬프트 설정 물건 정보를 요약한 게시글 제목과 물건의 카테고리도 생성하여 효율적인 프로세스 설계. <br><br> 2. 카테고리나 색상 등은 많은 경우의 수가 있기 때문에 **교내 분실물 게시판의 분실물 데이터를 분석**하여, 일반적인 범위를 설정하였습니다. 또한, **신용카드, 증명사진, 서류 등 개인정보가 포함된 물품**은 별도의 카테고리를 설정하여, 나중에 게시글에서 물건 사진이 보이지 않게 처리하여, 혹시 모를 보안 문제를 방지했습니다. |
| (4) 주요 기능의 구현 | **[ NGINX ]** <br> HTTP 프로토콜을 통해 클라이언트(프론트엔드)와 통신하기 위하여 오픈소스 웹서버 프로그램인 NGINX를 이용하였습니다. 분실물 검색 과정에서는 Scikit-Learn 패키지를 이용하기 때문에 일반적인 요청에 비해 오랜 응답 시간이 걸리는 것을 확인했습니다. 따라서, NGINX가 프록시 서버 통신을 위해 기다리는 시간을 최대 5분 (300s)로 설정하여 통신 중 연결이 끊어지지 않도록 설계하였습니다.<br> <img width="540" alt="스크린샷 2024-11-06 오후 11 20 46" src="https://github.com/user-attachments/assets/4ed40871-3072-46fa-b693-a3f6506984d2"> <br><br> **[배포 자동화]** <br> AWS 배포 이후 기능 수정이 필요할 경우의 번거로움을 줄이기 위해 **Git Actions**를 통해 배포를 자동화하였습니다. <br> deploy.yml 파일을 통해 **Git Actions을 통한 배포 자동화**를 구현하였습니다. C.LOVA에서는 **OpenAI**인 ChatGPT4o와 Google Cloud API, 여러 라이브러리를 사용합니다. API 사용을 위한 Secret json 파일과 API들의 KEY 등 중요 정보를 관리하는 ENV 파일은 보안 문제로 Git에 업로드 하지 않습니다. 이런 파일들은 Git Secrets에 따로 등록하여, deploy.yml에서 프로젝트를 Build할 때 이용할 수 있도록 설계하였습니다.<br><img width="549" alt="스크린샷 2024-11-06 오후 11 26 50" src="https://github.com/user-attachments/assets/f10410cf-663f-424b-90f9-2df63d230ecd"> <br><br> **[Docker 가상환경 Build]** <br> **Docker**를 통해 가상환경 컨테이너를 실행, 관리합니다. 빌드 과정에서 필요한 파이썬 패키지는 requirements.txt 파일에 정리하여 한번에 설치합니다. **Scikit Learn을 설치**하는 과정에서 서버 응답 시간과 메모리 사용량을 초과하는 문제를 해결하기 위하여 **python:3.8-slim-buster Image**를 Builder로 이용하였습니다. <br> <img width="523" alt="스크린샷 2024-11-06 오후 11 28 04" src="https://github.com/user-attachments/assets/3baa8cb3-57f2-49fd-8b4e-125ebae791d2"> <br><br> **[SMTP 프로토콜을 통한 이화인 인증]** <br> 교내 분실물을 대상으로 하는 서비스이기 때문에, 보안을 위하여 이화인만 가입할 수 있도록 하였습니다. 그러기 위해 이화인 메일 인증 프로세스가 필요합니다. 이화인 아이디를 입력하면, @ewha.ac.kr 의 도메인을 자동으로 붙여 Django.core.mail 을 이용해 메일을 발송하는 방식으로 구현하였습니다. <br> <img width="682" alt="스크린샷 2024-11-06 오후 11 28 57" src="https://github.com/user-attachments/assets/01322b32-c025-466e-9323-cef3e42e91c6"> <br> 웹페이지의 [request.data](http://request.data) 에서 email 변수를 찾아, @ewha.ac.kr 도메인을 붙인 email로 이메일을 발송합니다. Django.Core.Mail을 사용하기 위해서 settings 폴더의 [base.py](http://base.py)에서 아래와 같이 설정하였습니다. <br><img width="688" alt="스크린샷 2024-11-06 오후 11 29 45" src="https://github.com/user-attachments/assets/98bfbb40-2146-4a4d-923a-611450b15e0e"> <br>Host는 이메일 발송 및 팀 프로젝트 관리를 위한 구글 계정(2024clova)을 생성하여 설정하였습니다. 2024clova 내의 App Password 를 이용하여 2024clova@gmail.com가 요청한 사용자에게 이메일을 보낼 수 있도록 하였습니다.|
| (5) 기타 | *기타 사항을 기술*  |

<br>
